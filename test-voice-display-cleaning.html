<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Search Display Cleaning Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .voice-search-demo {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .search-bar {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 12px;
            color: white;
            width: 100%;
            margin: 10px 0;
        }
        .search-bar::placeholder {
            color: rgba(255,255,255,0.7);
        }
        .transcript-bubble {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            color: #333;
        }
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            padding: 15px;
            border-radius: 8px;
        }
        .before {
            background: #fee;
            border: 1px solid #fcc;
        }
        .after {
            background: #efe;
            border: 1px solid #cfc;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ Voice Search Display Cleaning Test</h1>
        <p>This page tests that voice search displays are properly cleaned and show no unwanted periods or punctuation.</p>

        <!-- Voice Search Demo UI -->
        <div class="voice-search-demo">
            <h3>üé§ Voice Search Interface Demo</h3>
            <p>This simulates the actual voice search interface with cleaning applied:</p>
            
            <!-- Search Bar -->
            <input 
                type="text" 
                class="search-bar" 
                id="demo-search-bar"
                placeholder="Search for products... (voice input will appear here)"
                readonly
            />
            
            <!-- Voice Status -->
            <div id="voice-status" class="status info" style="display: none;">
                üé§ Listening... Speak now!
            </div>
            
            <!-- Transcript Display -->
            <div id="transcript-display" style="display: none;">
                <div class="transcript-bubble">
                    <p style="margin: 0 0 5px 0; font-size: 12px; color: #666;">You said:</p>
                    <p id="transcript-text" style="margin: 0; font-weight: bold; color: #333;"></p>
                </div>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="test-section">
            <h3>üß™ Test Voice Search Cleaning</h3>
            <p>Click the button below to test voice search with automatic cleaning:</p>
            
            <button onclick="startVoiceTest()" id="voice-test-btn">üé§ Start Voice Test</button>
            <button onclick="simulateVoiceInput()" id="simulate-btn">üé≠ Simulate Voice Input</button>
            <button onclick="clearDemo()">üßπ Clear Demo</button>
            
            <div id="test-results"></div>
        </div>

        <!-- Before/After Examples -->
        <div class="test-section">
            <h3>üìù Before vs After Cleaning Examples</h3>
            <p>These examples show how voice input is cleaned before being displayed:</p>
            
            <div class="before-after">
                <div class="before">
                    <h4>‚ùå Before Cleaning (Raw Voice Input)</h4>
                    <ul>
                        <li>"Find Samsung phones."</li>
                        <li>"Show me Nike shoes, please!"</li>
                        <li>"I want iPhone 14 Pro Max..."</li>
                        <li>"Apple products under Rs. 50,000!!!"</li>
                        <li>"Beauty products for women???"</li>
                    </ul>
                </div>
                <div class="after">
                    <h4>‚úÖ After Cleaning (Displayed to User)</h4>
                    <ul>
                        <li>"find samsung phones"</li>
                        <li>"show me nike shoes please"</li>
                        <li>"i want iphone 14 pro max"</li>
                        <li>"apple products under rs 50000"</li>
                        <li>"beauty products for women"</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Interactive Test -->
        <div class="test-section">
            <h3>üîß Interactive Cleaning Test</h3>
            <p>Type text with punctuation to see how it gets cleaned for display:</p>
            
            <input 
                type="text" 
                id="test-input" 
                placeholder="Type text with periods, commas, etc..."
                style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;"
                oninput="testCleaning()"
            />
            
            <div id="cleaning-preview"></div>
        </div>

        <!-- Test Results Summary -->
        <div class="test-section">
            <h3>üìä Test Results Summary</h3>
            <div id="test-summary">
                <p>Run the voice test to see results...</p>
            </div>
        </div>
    </div>

    <script>
        // Voice search cleaning function (matches the implementation)
        function cleanTranscript(text) {
            if (!text) return '';
            
            return text
                // Remove trailing periods, commas, and other punctuation
                .replace(/[.,!?;:]+$/g, '')
                // Remove multiple spaces
                .replace(/\s+/g, ' ')
                // Remove leading/trailing whitespace
                .trim()
                // Convert to lowercase for consistency
                .toLowerCase()
                // Remove any remaining unwanted characters but keep essential ones
                .replace(/[^\w\s\-']/g, '')
                // Clean up any double spaces that might have been created
                .replace(/\s+/g, ' ')
                .trim();
        }

        // Test cases for simulation
        const testCases = [
            "Find Samsung phones.",
            "Show me Nike shoes, please!",
            "I want iPhone 14 Pro Max...",
            "Apple products under Rs. 50,000!!!",
            "Beauty products for women???",
            "Electronics... under 25000...",
            "Search for wireless earbuds!!",
            "Nike Air Jordan 1 Chicago, size 10.",
        ];

        let currentTestIndex = 0;

        function startVoiceTest() {
            const btn = document.getElementById('voice-test-btn');
            const resultsDiv = document.getElementById('test-results');
            
            // Check if speech recognition is supported
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                resultsDiv.innerHTML = '<div class="status error">‚ùå Speech Recognition not supported in this browser</div>';
                return;
            }
            
            const recognition = new SpeechRecognition();
            recognition.lang = 'en-IN';
            recognition.continuous = false;
            recognition.interimResults = true;
            
            btn.disabled = true;
            btn.textContent = 'üé§ Listening... (speak now)';
            
            // Show voice status
            const statusDiv = document.getElementById('voice-status');
            statusDiv.style.display = 'block';
            statusDiv.textContent = 'üé§ Listening... Speak a search query!';
            
            resultsDiv.innerHTML = '<div class="status info">üé§ Voice recognition started. Please speak clearly!</div>';
            
            const timeout = setTimeout(() => {
                recognition.stop();
                resultsDiv.innerHTML = '<div class="status warning">‚è∞ Timeout - No speech detected. Try speaking louder or check microphone permissions.</div>';
                resetVoiceTest();
            }, 10000);
            
            recognition.onresult = (event) => {
                clearTimeout(timeout);
                const transcript = event.results[0][0].transcript;
                const confidence = event.results[0][0].confidence || 0;
                const isFinal = event.results[0].isFinal;
                
                if (isFinal) {
                    // Test the cleaning
                    const cleaned = cleanTranscript(transcript);
                    
                    // Update demo UI
                    updateDemoUI(transcript, cleaned);
                    
                    // Show results
                    resultsDiv.innerHTML = `
                        <div class="status success">
                            <strong>‚úÖ Voice Recognition Successful!</strong><br><br>
                            <strong>Original Speech:</strong> "${transcript}"<br>
                            <strong>Cleaned for Display:</strong> "${cleaned}"<br>
                            <strong>Confidence:</strong> ${Math.round(confidence * 100)}%<br>
                            <strong>Periods Removed:</strong> ${transcript.includes('.') ? 'Yes ‚úÖ' : 'None found'}<br>
                            <strong>Punctuation Cleaned:</strong> ${transcript !== cleaned ? 'Yes ‚úÖ' : 'No changes needed'}
                        </div>
                    `;
                    
                    updateTestSummary(transcript, cleaned, confidence);
                    resetVoiceTest();
                }
            };
            
            recognition.onerror = (event) => {
                clearTimeout(timeout);
                resultsDiv.innerHTML = `
                    <div class="status error">
                        ‚ùå Voice recognition error: ${event.error}<br>
                        Try speaking clearly or check microphone permissions.
                    </div>
                `;
                resetVoiceTest();
            };
            
            recognition.start();
        }

        function simulateVoiceInput() {
            const testCase = testCases[currentTestIndex];
            const cleaned = cleanTranscript(testCase);
            
            // Update demo UI
            updateDemoUI(testCase, cleaned);
            
            // Show results
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `
                <div class="status success">
                    <strong>üé≠ Simulated Voice Input</strong><br><br>
                    <strong>Simulated Speech:</strong> "${testCase}"<br>
                    <strong>Cleaned for Display:</strong> "${cleaned}"<br>
                    <strong>Periods Removed:</strong> ${testCase.includes('.') ? 'Yes ‚úÖ' : 'None found'}<br>
                    <strong>Punctuation Cleaned:</strong> ${testCase !== cleaned ? 'Yes ‚úÖ' : 'No changes needed'}
                </div>
            `;
            
            updateTestSummary(testCase, cleaned, 1.0);
            
            // Cycle through test cases
            currentTestIndex = (currentTestIndex + 1) % testCases.length;
        }

        function updateDemoUI(original, cleaned) {
            // Update search bar
            const searchBar = document.getElementById('demo-search-bar');
            searchBar.value = cleaned;
            
            // Update transcript display
            const transcriptDisplay = document.getElementById('transcript-display');
            const transcriptText = document.getElementById('transcript-text');
            transcriptDisplay.style.display = 'block';
            transcriptText.textContent = cleaned;
            
            // Hide voice status
            const statusDiv = document.getElementById('voice-status');
            statusDiv.style.display = 'none';
        }

        function clearDemo() {
            document.getElementById('demo-search-bar').value = '';
            document.getElementById('transcript-display').style.display = 'none';
            document.getElementById('voice-status').style.display = 'none';
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('test-summary').innerHTML = '<p>Run the voice test to see results...</p>';
        }

        function resetVoiceTest() {
            const btn = document.getElementById('voice-test-btn');
            btn.disabled = false;
            btn.textContent = 'üé§ Start Voice Test';
            
            const statusDiv = document.getElementById('voice-status');
            statusDiv.style.display = 'none';
        }

        function testCleaning() {
            const input = document.getElementById('test-input').value;
            const cleaned = cleanTranscript(input);
            const preview = document.getElementById('cleaning-preview');
            
            if (input) {
                preview.innerHTML = `
                    <div style="margin-top: 10px;">
                        <div class="before" style="margin-bottom: 10px;">
                            <strong>Original:</strong> "${input}"
                        </div>
                        <div class="after">
                            <strong>Cleaned:</strong> "${cleaned}"
                        </div>
                    </div>
                `;
            } else {
                preview.innerHTML = '';
            }
        }

        function updateTestSummary(original, cleaned, confidence) {
            const summary = document.getElementById('test-summary');
            const hasPunctuation = /[.,!?;:]+$/.test(original);
            const wasChanged = original !== cleaned;
            
            summary.innerHTML = `
                <div class="status ${wasChanged ? 'success' : 'info'}">
                    <h4>üìä Test Results</h4>
                    <ul>
                        <li><strong>Input Length:</strong> ${original.length} characters</li>
                        <li><strong>Output Length:</strong> ${cleaned.length} characters</li>
                        <li><strong>Had Trailing Punctuation:</strong> ${hasPunctuation ? 'Yes' : 'No'}</li>
                        <li><strong>Was Cleaned:</strong> ${wasChanged ? 'Yes ‚úÖ' : 'No changes needed'}</li>
                        <li><strong>Confidence:</strong> ${Math.round(confidence * 100)}%</li>
                        <li><strong>Display Quality:</strong> ${cleaned.length > 0 ? 'Clean ‚úÖ' : 'Empty ‚ö†Ô∏è'}</li>
                    </ul>
                </div>
            `;
        }

        // Initialize page
        window.onload = function() {
            console.log('üßπ Voice Search Display Cleaning Test Page Loaded');
            
            // Test all examples
            console.log('Testing cleaning examples:');
            testCases.forEach((testCase, index) => {
                const cleaned = cleanTranscript(testCase);
                console.log(`${index + 1}. "${testCase}" ‚Üí "${cleaned}"`);
            });
        };
    </script>
</body>
</html>
